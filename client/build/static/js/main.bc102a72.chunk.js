(this["webpackJsonpreact-social"]=this["webpackJsonpreact-social"]||[]).push([[0],{112:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){},119:function(e,t,n){},149:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),s=n(73),a=n.n(s),i=n(3),o=n.n(i),l=n(5),u=n(7),j=n.n(u),d=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n({type:"LOGIN_START"}),e.prev=1,e.next=4,j.a.post("/auth/login",t);case 4:c=e.sent,console.log(c.data),n({type:"LOGIN_SUCCESS",payload:c.data}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),n({type:"LOGIN_FAILURE",payload:e.t0});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t({type:"LOGOUT_SUCCESS"})}catch(n){t({type:"LOGOUT_FAILURE",payload:n})}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=n(8),h=n(32),O=n(22),f=function(e,t){switch(t.type){case"LOGIN_START":return{user:null,isFetching:!0,error:!1};case"LOGIN_SUCCESS":return{user:t.payload,isFetching:!1,error:!1};case"LOGIN_FAILURE":return{user:null,isFetching:!1,error:!0};case"FOLLOW":return Object(O.a)(Object(O.a)({},e),{},{user:Object(O.a)(Object(O.a)({},e.user),{},{followings:[].concat(Object(h.a)(e.user.followings),[t.payload])})});case"UNFOLLOW":return Object(O.a)(Object(O.a)({},e),{},{user:Object(O.a)(Object(O.a)({},e.user),{},{followings:e.user.followings.filter((function(e){return e!==t.payload}))})});case"LOGOUT_SUCCESS":return{user:null,isFetching:!1,error:!1};case"LOGOUT_FAILURE":return{user:null,isFetching:!1,error:!0};default:return e}},m=n(0),x={user:JSON.parse(localStorage.getItem("user"))||null,isFetching:!1,error:!1},v=Object(c.createContext)(x),g=function(e){var t=e.children,n=Object(c.useReducer)(f,x),r=Object(p.a)(n,2),s=r[0],a=r[1];return Object(c.useEffect)((function(){localStorage.setItem("user",JSON.stringify(s.user))}),[s.user]),Object(m.jsx)(v.Provider,{value:{user:s.user,isFetching:s.isFetching,error:s.error,dispatch:a},children:t})},N=n(163),w=n(4);function I(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useContext)(v),r=n.isFetching,s=n.dispatch,a=Object(w.g)(),i=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault();try{a.push("/register")}catch(n){console.log(n)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsx)("div",{className:"login",children:Object(m.jsxs)("div",{className:"loginWrapper",children:[Object(m.jsxs)("div",{className:"loginLeft",children:[Object(m.jsx)("h3",{className:"loginLogo",children:"chatApp"}),Object(m.jsx)("span",{className:"loginDesc",children:"Connect with friends and the world around you on chatApp."})]}),Object(m.jsx)("div",{className:"loginRight",children:Object(m.jsxs)("form",{className:"loginBox",onSubmit:function(n){n.preventDefault(),d({email:e.current.value,password:t.current.value},s)},style:{height:"300px"},children:[Object(m.jsx)("input",{placeholder:"Email",type:"email",required:!0,className:"loginInput",ref:e}),Object(m.jsx)("input",{placeholder:"Password",type:"password",required:!0,minLength:"6",className:"loginInput",ref:t}),Object(m.jsx)("button",{className:"loginButton",type:"submit",disabled:r,children:r?Object(m.jsx)(N.a,{color:"primary",size:"20px"}):"Log In"}),Object(m.jsx)("button",{className:"loginRegisterButton",onClick:i,children:r?Object(m.jsx)(N.a,{color:"primary",size:"20px"}):"Create a New Account"})]})})]})})}n(112),n(113);var y=n(164),C=n(23);function k(){var e=Object(c.useContext)(v).user,t=Object(c.useContext)(v).dispatch,n=Object(w.g)(),r=Object(c.useState)(""),s=Object(p.a)(r,2),a=s[0],i=s[1];return Object(m.jsxs)("div",{className:"topbarContainer",children:[Object(m.jsx)("div",{className:"topbarLeft",children:Object(m.jsx)(C.b,{to:"/",style:{textDecoration:"none"},children:Object(m.jsx)("span",{className:"logo",children:"chatApp"})})}),Object(m.jsx)("div",{className:"topbarCenter",children:Object(m.jsx)("div",{className:"searchbar",children:Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault();try{n.push("/profile/".concat(a))}catch(t){console.log(t)}},children:[Object(m.jsx)(y.a,{className:"searchIcon"}),Object(m.jsx)("input",{placeholder:"Search for People",className:"searchInput",onChange:function(e){return i(e.target.value)},value:a})]})})}),Object(m.jsxs)("div",{className:"topbarRight",children:[Object(m.jsxs)("div",{className:"topbarLinks",children:[Object(m.jsx)(C.b,{to:"/",children:Object(m.jsx)("span",{className:"topbarLink",children:"Messenger"})}),Object(m.jsx)(C.b,{to:"/profile/".concat(e.username),children:Object(m.jsx)("span",{className:"topbarLink",children:"Profile"})})]}),Object(m.jsx)("span",{onClick:function(e){console.log("HJJJJ"),e.preventDefault(),b(t),n.push("/login")},className:"topbarLogout",children:"Logout"})]})]})}n(114);var S=n(165),_=n(166);function L(e){var t=e.user,n="http://localhost:8800/images/",r=Object(c.useState)([]),s=Object(p.a)(r,2),a=s[0],i=s[1],u=Object(c.useContext)(v),d=u.user,b=u.dispatch,h=Object(c.useState)(d.followings.includes(t._id)),O=Object(p.a)(h,2),f=O[0],x=O[1];Object(c.useEffect)((function(){x(d.followings.includes(null===t||void 0===t?void 0:t._id)),function(){var e=Object(l.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get("/users/friends/"+t._id);case 3:n=e.sent,i(n.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()()}),[t,d]);var g=function(){var e=Object(l.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!f){e.next=7;break}return e.next=4,j.a.put("/users/".concat(t._id,"/unfollow"),{userId:d._id});case 4:b({type:"UNFOLLOW",payload:t._id}),e.next=17;break;case 7:return e.next=9,j.a.put("/users/".concat(t._id,"/follow"),{userId:d._id});case 9:return b({type:"FOLLOW",payload:t._id}),e.next=12,j.a.get("/conversations/find/".concat(t._id,"/").concat(d._id),{});case 12:if(n=e.sent,console.log(n,"HELOOO"),null!=n.data){e.next=17;break}return e.next=17,j.a.post("/conversations/",{senderId:d._id,receiverId:t._id});case 17:x(!f),e.next=22;break;case 20:e.prev=20,e.t0=e.catch(0);case 22:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}(),N=function(){return Object(m.jsxs)(m.Fragment,{children:[t.username!==d.username&&Object(m.jsxs)("button",{className:"rightbarFollowButton",onClick:g,children:[f?"Unfollow":"Follow",f?Object(m.jsx)(S.a,{}):Object(m.jsx)(_.a,{})]}),Object(m.jsx)("h4",{className:"rightbarTitle",children:"User information"}),Object(m.jsxs)("div",{className:"rightbarInfo",children:[Object(m.jsxs)("div",{className:"rightbarInfoItem",children:[Object(m.jsx)("span",{className:"rightbarInfoKey",children:"City:"}),Object(m.jsx)("span",{className:"rightbarInfoValue",children:t.city})]}),Object(m.jsxs)("div",{className:"rightbarInfoItem",children:[Object(m.jsx)("span",{className:"rightbarInfoKey",children:"Desc:"}),Object(m.jsx)("span",{className:"rightbarInfoValue",children:t.desc})]}),Object(m.jsxs)("div",{className:"rightbarInfoItem",children:[Object(m.jsx)("span",{className:"rightbarInfoKey",children:"Relationship:"}),Object(m.jsx)("span",{className:"rightbarInfoValue",children:""!==t.relationship?t.relationship:"Not Indicated"})]})]}),Object(m.jsx)("h4",{className:"rightbarTitle",children:"User friends"}),Object(m.jsx)("div",{className:"rightbarFollowings",children:a.map((function(e){return Object(m.jsx)(C.b,{to:"/profile/"+e.username,style:{textDecoration:"none"},className:"linkspace",children:Object(m.jsxs)("div",{className:"rightbarFollowing",children:[Object(m.jsx)("img",{src:e.profilePicture?n+e.profilePicture:n+"person/noAvatar.png",alt:"",className:"rightbarFollowingImg"}),Object(m.jsx)("span",{className:"rightbarFollowingName",children:e.username})]})})}))})]})};return Object(m.jsx)("div",{className:"rightbar",children:Object(m.jsx)("div",{className:"rightbarWrapper",children:Object(m.jsx)(N,{})})})}function F(){var e="http://localhost:8800/images/",t=Object(c.useState)({}),n=Object(p.a)(t,2),r=n[0],s=n[1],a=Object(w.h)().username;return Object(c.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.get("/users?username=".concat(a));case 2:t=e.sent,s(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[a]),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(k,{}),Object(m.jsx)("div",{className:"profile",children:Object(m.jsxs)("div",{className:"profileRight",children:[Object(m.jsxs)("div",{className:"profileRightTop",children:[Object(m.jsxs)("div",{className:"profileCover",children:[Object(m.jsx)("img",{className:"profileCoverImg",src:r.coverPicture?e+r.coverPicture:e+"person/noCover.jpeg",alt:""}),Object(m.jsx)("img",{className:"profileUserImg",src:r.profilePicture?e+r.profilePicture:e+"person/noAvatar.png",alt:""})]}),Object(m.jsxs)("div",{className:"profileInfo",children:[Object(m.jsx)("h4",{className:"profileInfoName",children:r.username}),Object(m.jsx)("span",{className:"profileInfoDesc",children:r.desc})]})]}),Object(m.jsx)("div",{className:"profileRightBottom",children:Object(m.jsx)(L,{user:r})})]})})]})}n(115);function R(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useRef)(),r=Object(c.useRef)(),s=Object(c.useRef)(),a=Object(c.useRef)(),i=Object(c.useRef)(),u=Object(w.g)(),d=function(){var c=Object(l.a)(o.a.mark((function c(l){var d;return o.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(l.preventDefault(),r.current.value===n.current.value){c.next=5;break}r.current.setCustomValidity("Passwords don't match!"),c.next=15;break;case 5:return d={username:e.current.value,email:t.current.value,password:n.current.value,city:s.current.value,relationship:a.current.value,desc:i.current.value},c.prev=6,c.next=9,j.a.post("/auth/register",d);case 9:u.push("/login"),c.next=15;break;case 12:c.prev=12,c.t0=c.catch(6),console.log(c.t0);case 15:case"end":return c.stop()}}),c,null,[[6,12]])})));return function(e){return c.apply(this,arguments)}}(),b=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault();try{u.push("/login")}catch(n){console.log(n)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsx)("div",{className:"login",children:Object(m.jsxs)("div",{className:"loginWrapper",children:[Object(m.jsxs)("div",{className:"loginLeft",children:[Object(m.jsx)("h3",{className:"loginLogo",children:"chatApp"}),Object(m.jsx)("span",{className:"loginDesc",children:"Connect with friends and the world around you on chatApp."})]}),Object(m.jsx)("div",{className:"loginRight",children:Object(m.jsxs)("form",{className:"loginBox",onSubmit:d,children:[Object(m.jsx)("input",{placeholder:"Username",required:!0,ref:e,className:"loginInput"}),Object(m.jsx)("input",{placeholder:"City",required:!0,ref:s,className:"loginInput"}),Object(m.jsx)("input",{placeholder:"Relationship Status",ref:a,className:"loginInput"}),Object(m.jsx)("textarea",{placeholder:"Description",ref:i,className:"loginInput"}),Object(m.jsx)("input",{placeholder:"Email",required:!0,ref:t,className:"loginInput",type:"email"}),Object(m.jsx)("input",{placeholder:"Password",required:!0,ref:n,className:"loginInput",type:"password",minLength:"6"}),Object(m.jsx)("input",{placeholder:"Password Again",required:!0,ref:r,className:"loginInput",type:"password"}),Object(m.jsx)("button",{className:"loginButton",type:"submit",children:"Sign Up"}),Object(m.jsx)("button",{className:"loginRegisterButton",onClick:b,children:"Log into Account"})]})})]})})}n(116),n(117);function U(e){var t=e.conversation,n=e.currentUser,r=Object(c.useState)(null),s=Object(p.a)(r,2),a=s[0],i=s[1],u="http://localhost:8800/images/";return Object(c.useEffect)((function(){var e=t.members.find((function(e){return e!==n._id}));(function(){var t=Object(l.a)(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,j()("/users?userId="+e);case 3:n=t.sent,i(n.data),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}})()()}),[n,t]),Object(m.jsxs)("div",{className:"conversation",children:[Object(m.jsx)("img",{className:"conversationImg",src:(null===a||void 0===a?void 0:a.profilePicture)?u+a.profilePicture:u+"person/noAvatar.png",alt:""}),Object(m.jsx)("span",{className:"conversationName",children:null===a||void 0===a?void 0:a.username})]})}n(118);var E=n(79);function A(e){var t=e.message,n=e.own;return Object(m.jsxs)("div",{className:n?"message own":"message",children:[Object(m.jsxs)("div",{className:"messageTop",children:[Object(m.jsx)("img",{className:"messageImg",src:"http://localhost:8800/images/person/noAvatar.png",alt:""}),Object(m.jsx)("p",{className:"messageText",children:t.text})]}),Object(m.jsx)("div",{className:"messageBottom",children:Object(E.a)(t.createdAt)})]})}n(119);function B(e){var t=e.onlineUsers,n=e.currentId,r=e.setCurrentChat,s=Object(c.useState)([]),a=Object(p.a)(s,2),i=a[0],u=a[1],d=Object(c.useState)([]),b=Object(p.a)(d,2),h=b[0],O=b[1],f="http://localhost:8800/images/";Object(c.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.get("/users/friends/"+n);case 2:t=e.sent,u(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[n]),Object(c.useEffect)((function(){O(i.filter((function(e){return t.includes(e._id)})))}),[i,t]);var x=function(){var e=Object(l.a)(o.a.mark((function e(t){var c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get("/conversations/find/".concat(n,"/").concat(t._id));case 3:c=e.sent,r(c.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsx)("div",{className:"chatOnline",children:h.map((function(e){return Object(m.jsxs)("div",{className:"chatOnlineFriend",onClick:function(){return x(e)},children:[Object(m.jsxs)("div",{className:"chatOnlineImgContainer",children:[Object(m.jsx)("img",{className:"chatOnlineImg",src:(null===e||void 0===e?void 0:e.profilePicture)?f+e.profilePicture:f+"person/noAvatar.png",alt:""}),Object(m.jsx)("div",{className:"chatOnlineBadge"})]}),Object(m.jsx)("span",{className:"chatOnlineName",children:null===e||void 0===e?void 0:e.username})]},e._id)}))})}var P=n(78);function D(){var e=Object(c.useState)([]),t=Object(p.a)(e,2),n=t[0],r=t[1],s=Object(c.useState)(null),a=Object(p.a)(s,2),i=a[0],u=a[1],d=Object(c.useState)([]),b=Object(p.a)(d,2),O=b[0],f=b[1],x=Object(c.useState)(""),g=Object(p.a)(x,2),N=g[0],w=g[1],I=Object(c.useState)(null),y=Object(p.a)(I,2),C=y[0],S=y[1],_=Object(c.useState)([]),L=Object(p.a)(_,2),F=L[0],R=L[1],E=Object(c.useRef)(),D=Object(c.useContext)(v).user,T=Object(c.useRef)();Object(c.useEffect)((function(){E.current=Object(P.io)("ws://localhost:8800"),E.current.on("getMessage",(function(e){S({sender:e.senderId,text:e.text,createdAt:Date.now()})}))}),[]),Object(c.useEffect)((function(){C&&(null===i||void 0===i?void 0:i.members.includes(C.sender))&&f((function(e){return[].concat(Object(h.a)(e),[C])}))}),[C,i]),Object(c.useEffect)((function(){E.current.emit("addUser",D._id),E.current.on("getUsers",(function(e){R(D.followings.filter((function(t){return e.some((function(e){return e.userId===t}))})))}))}),[D]),Object(c.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get("/conversations/"+D._id);case 3:t=e.sent,r(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[D._id]),Object(c.useEffect)((function(){(function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get("/messages/"+(null===i||void 0===i?void 0:i._id));case 3:t=e.sent,f(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[i]);var G=function(){var e=Object(l.a)(o.a.mark((function e(t){var n,c,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={sender:D._id,text:N,conversationId:i._id},c=i.members.find((function(e){return e!==D._id})),E.current.emit("sendMessage",{senderId:D._id,receiverId:c,text:N}),e.prev=4,e.next=7,j.a.post("/messages",n);case 7:r=e.sent,f([].concat(Object(h.a)(O),[r.data])),w(""),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){var e;null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[O]),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(k,{}),Object(m.jsxs)("div",{className:"messenger",children:[Object(m.jsx)("div",{className:"chatMenu",children:Object(m.jsxs)("div",{className:"chatMenuWrapper",children:[Object(m.jsx)("input",{placeholder:"Search for friends",className:"chatMenuInput"}),n.map((function(e){return Object(m.jsx)("div",{onClick:function(){return u(e)},children:Object(m.jsx)(U,{conversation:e,currentUser:D},e._id)})}))]})}),Object(m.jsx)("div",{className:"chatBox",children:Object(m.jsx)("div",{className:"chatBoxWrapper",children:i?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{className:"chatBoxTop",children:O.map((function(e){return Object(m.jsx)("div",{ref:T,children:Object(m.jsx)(A,{message:e,own:e.sender===D._id},e._id)})}))}),Object(m.jsxs)("div",{className:"chatBoxBottom",children:[Object(m.jsx)("textarea",{className:"chatMessageInput",placeholder:"write something...",onChange:function(e){return w(e.target.value)},value:N}),Object(m.jsx)("button",{className:"chatSubmitButton",onClick:G,children:"Send"})]})]}):Object(m.jsx)("span",{className:"noConversationText",children:"No Conversation has Been opened."})})}),Object(m.jsx)("div",{className:"chatOnline",children:Object(m.jsx)("div",{className:"chatOnlineWrapper",children:Object(m.jsx)(B,{onlineUsers:F,currentId:D._id,setCurrentChat:u})})})]})]})}var T=function(){var e=Object(c.useContext)(v).user;return Object(m.jsx)(C.a,{children:Object(m.jsxs)(w.d,{children:[Object(m.jsx)(w.b,{exact:!0,path:"/",children:e?Object(m.jsx)(D,{}):Object(m.jsx)(R,{})}),Object(m.jsx)(w.b,{path:"/login",children:e?Object(m.jsx)(w.a,{to:"/"}):Object(m.jsx)(I,{})}),Object(m.jsx)(w.b,{path:"/register",children:e?Object(m.jsx)(w.a,{to:"/"}):Object(m.jsx)(R,{})}),Object(m.jsx)(w.b,{path:"/profile/:username",children:Object(m.jsx)(F,{})})]})})};a.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsx)(g,{children:Object(m.jsx)(T,{})})}),document.getElementById("root"))}},[[149,1,2]]]);
//# sourceMappingURL=main.bc102a72.chunk.js.map